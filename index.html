import React, { useState, useEffect, useRef } from 'react';
import { Heart, Volume2, VolumeX, RotateCcw } from 'lucide-react';

const EternalUniverse = () => {
  const [scene, setScene] = useState('void');
  const [audioEnabled, setAudioEnabled] = useState(false);
  const [selectedPlanet, setSelectedPlanet] = useState(null);
  const [starBurst, setStarBurst] = useState(false);
  const canvasRef = useRef(null);
  const audioContextRef = useRef(null);

  // Love story data - CUSTOMIZE THIS
  const planets = [
    {
      id: 'first-spark',
      name: 'First Spark',
      color: '#FF6B9D',
      x: 30,
      y: 25,
      message: 'The moment our eyes met, time stopped. It was just you and me in a crowded world.',
      memory: 'Remember how nervous I was? Your smile made everything feel right.'
    },
    {
      id: 'moments',
      name: 'Our Moments',
      color: '#C780FA',
      x: 70,
      y: 35,
      message: 'Every laugh, every adventure, every quiet moment. They all led me deeper into you.',
      memory: 'From midnight talks to silly fights, every second with you is my favorite story.'
    },
    {
      id: 'dreams',
      name: 'Dreams Together',
      color: '#4ECDC4',
      x: 50,
      y: 70,
      message: 'I see us traveling the world, building a home, creating a life that feels like forever.',
      memory: 'Every dream I have now has you in it. You\'re my future.'
    },
    {
      id: 'my-world',
      name: 'My World',
      color: '#FFE66D',
      x: 20,
      y: 60,
      message: 'You\'re not just in my life. You ARE my life. My reason, my peace, my everything.',
      memory: 'Before you, I was existing. With you, I\'m alive.'
    }
  ];

  // Starfield animation
  useEffect(() => {
    if (scene === 'void' || !canvasRef.current) return;

    const canvas = canvasRef.current;
    const ctx = canvas.getContext('2d');
    let animationId;
    let stars = [];

    const resizeCanvas = () => {
      canvas.width = window.innerWidth;
      canvas.height = window.innerHeight;
      initStars();
    };

    const initStars = () => {
      stars = [];
      const starCount = window.innerWidth < 768 ? 150 : 300;
      for (let i = 0; i < starCount; i++) {
        stars.push({
          x: Math.random() * canvas.width,
          y: Math.random() * canvas.height,
          size: Math.random() * 2,
          speed: Math.random() * 0.5 + 0.1,
          opacity: Math.random()
        });
      }
    };

    const animate = () => {
      ctx.fillStyle = 'rgba(10, 10, 25, 0.1)';
      ctx.fillRect(0, 0, canvas.width, canvas.height);

      stars.forEach(star => {
        ctx.fillStyle = `rgba(255, 255, 255, ${star.opacity})`;
        ctx.beginPath();
        ctx.arc(star.x, star.y, star.size, 0, Math.PI * 2);
        ctx.fill();

        star.opacity = Math.sin(Date.now() * 0.001 + star.x) * 0.5 + 0.5;
      });

      animationId = requestAnimationFrame(animate);
    };

    resizeCanvas();
    window.addEventListener('resize', resizeCanvas);
    animate();

    return () => {
      window.removeEventListener('resize', resizeCanvas);
      cancelAnimationFrame(animationId);
    };
  }, [scene]);

  // Simple heartbeat sound using Web Audio API
  const playHeartbeat = () => {
    if (!audioContextRef.current) {
      audioContextRef.current = new (window.AudioContext || window.webkitAudioContext)();
    }
    const ctx = audioContextRef.current;
    const osc = ctx.createOscillator();
    const gain = ctx.createGain();
    
    osc.connect(gain);
    gain.connect(ctx.destination);
    
    osc.frequency.value = 55;
    gain.gain.setValueAtTime(0.1, ctx.currentTime);
    gain.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + 0.5);
    
    osc.start(ctx.currentTime);
    osc.stop(ctx.currentTime + 0.5);
  };

  useEffect(() => {
    if (audioEnabled && scene !== 'void' && scene !== 'final') {
      const interval = setInterval(playHeartbeat, 1200);
      return () => clearInterval(interval);
    }
  }, [audioEnabled, scene]);

  const handleStart = () => {
    setScene('birth');
    setStarBurst(true);
    setTimeout(() => {
      setScene('universe');
      setStarBurst(false);
    }, 3000);
  };

  const handlePlanetClick = (planet) => {
    setSelectedPlanet(planet);
  };

  const closePlanet = () => {
    setSelectedPlanet(null);
  };

  const goToFinal = () => {
    setScene('final');
  };

  const replay = () => {
    setScene('void');
    setSelectedPlanet(null);
  };

  return (
    <div className="relative w-full h-screen overflow-hidden bg-gradient-to-b from-[#0a0a19] via-[#1a0a2e] to-[#0a0a19]">
      <canvas ref={canvasRef} className="absolute inset-0 w-full h-full" />

      {/* Audio Toggle */}
      {scene !== 'void' && (
        <button
          onClick={() => setAudioEnabled(!audioEnabled)}
          className="absolute top-4 right-4 z-50 p-3 rounded-full bg-white/10 backdrop-blur-sm border border-white/20 hover:bg-white/20 transition-all"
        >
          {audioEnabled ? <Volume2 className="w-5 h-5 text-white" /> : <VolumeX className="w-5 h-5 text-white" />}
        </button>
      )}

      {/* VOID SCENE */}
      {scene === 'void' && (
        <div className="absolute inset-0 flex items-center justify-center">
          <div className="text-center px-6 animate-fade-in">
            <div className="mb-8">
              {[...Array(20)].map((_, i) => (
                <div
                  key={i}
                  className="absolute animate-twinkle"
                  style={{
                    left: `${Math.random() * 100}%`,
                    top: `${Math.random() * 100}%`,
                    width: '2px',
                    height: '2px',
                    backgroundColor: 'white',
                    borderRadius: '50%',
                    animationDelay: `${Math.random() * 3}s`
                  }}
                />
              ))}
            </div>
            <h1 className="text-white text-2xl md:text-4xl font-light mb-8 animate-pulse-slow">
              Before there was us...
            </h1>
            <p className="text-white/60 text-lg md:text-xl mb-12">there was silence.</p>
            <button
              onClick={handleStart}
              className="px-8 py-4 bg-white/10 backdrop-blur-sm border border-white/30 rounded-full text-white hover:bg-white/20 transition-all duration-300 text-lg"
            >
              Begin the Journey
            </button>
          </div>
        </div>
      )}

      {/* BIRTH SCENE */}
      {scene === 'birth' && (
        <div className="absolute inset-0 flex items-center justify-center">
          <div className="text-center px-6">
            <div className={`mb-8 ${starBurst ? 'animate-star-burst' : ''}`}>
              <div className="w-32 h-32 md:w-48 md:h-48 mx-auto rounded-full bg-gradient-to-r from-yellow-200 via-yellow-400 to-yellow-200 animate-pulse-glow shadow-2xl shadow-yellow-500/50" />
            </div>
            <h1 className="text-white text-3xl md:text-5xl font-light animate-fade-in-up">
              Then, you appeared.
            </h1>
          </div>
        </div>
      )}

      {/* UNIVERSE SCENE */}
      {scene === 'universe' && !selectedPlanet && (
        <div className="absolute inset-0">
          {/* Center Sun (Her) */}
          <div className="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2">
            <div className="w-24 h-24 md:w-32 md:h-32 rounded-full bg-gradient-to-r from-yellow-200 via-yellow-400 to-yellow-200 animate-pulse-glow shadow-2xl shadow-yellow-500/50" />
            <p className="text-white text-center mt-4 text-sm md:text-base font-light">You</p>
          </div>

          {/* Orbiting Planets */}
          {planets.map((planet, idx) => (
            <button
              key={planet.id}
              onClick={() => handlePlanetClick(planet)}
              className="absolute animate-float group"
              style={{
                left: `${planet.x}%`,
                top: `${planet.y}%`,
                animationDelay: `${idx * 0.5}s`
              }}
            >
              <div
                className="w-16 h-16 md:w-20 md:h-20 rounded-full border-4 border-white/20 backdrop-blur-sm hover:scale-110 transition-transform duration-300"
                style={{ backgroundColor: planet.color }}
              />
              <p className="text-white text-xs md:text-sm text-center mt-2 opacity-0 group-hover:opacity-100 transition-opacity">
                {planet.name}
              </p>
            </button>
          ))}

          {/* Eternal Star */}
          <button
            onClick={goToFinal}
            className="absolute top-[15%] right-[10%] animate-pulse-glow group"
          >
            <div className="w-20 h-20 md:w-24 md:h-24 rounded-full bg-gradient-to-r from-pink-300 via-purple-300 to-blue-300 shadow-2xl shadow-purple-500/50 hover:scale-110 transition-transform" />
            <p className="text-white text-sm md:text-base text-center mt-2">✨ Eternal Star</p>
          </button>

          {/* Instructions */}
          <div className="absolute bottom-8 left-1/2 -translate-x-1/2 text-center px-6">
            <p className="text-white/60 text-sm md:text-base">Touch the planets to explore our story</p>
          </div>
        </div>
      )}

      {/* PLANET DETAIL */}
      {selectedPlanet && (
        <div className="absolute inset-0 flex items-center justify-center bg-black/70 backdrop-blur-md z-40 animate-fade-in p-6">
          <div className="bg-white/10 backdrop-blur-lg border border-white/20 rounded-3xl p-8 md:p-12 max-w-2xl animate-scale-in">
            <div
              className="w-20 h-20 md:w-24 md:h-24 mx-auto rounded-full mb-6 animate-pulse-glow"
              style={{ backgroundColor: selectedPlanet.color }}
            />
            <h2 className="text-white text-2xl md:text-4xl font-light mb-6 text-center">
              {selectedPlanet.name}
            </h2>
            <p className="text-white/90 text-base md:text-lg mb-6 leading-relaxed text-center">
              {selectedPlanet.message}
            </p>
            <p className="text-white/70 text-sm md:text-base italic text-center mb-8">
              {selectedPlanet.memory}
            </p>
            <button
              onClick={closePlanet}
              className="block mx-auto px-8 py-3 bg-white/20 backdrop-blur-sm border border-white/30 rounded-full text-white hover:bg-white/30 transition-all"
            >
              Continue Journey
            </button>
          </div>
        </div>
      )}

      {/* FINAL SCENE */}
      {scene === 'final' && (
        <div className="absolute inset-0 flex items-center justify-center px-6">
          <div className="text-center max-w-3xl animate-fade-in">
            <div className="mb-8 relative">
              <Heart className="w-32 h-32 md:w-48 md:h-48 mx-auto text-pink-400 animate-pulse-glow" fill="currentColor" />
              <div className="absolute inset-0 animate-ping-slow">
                <Heart className="w-32 h-32 md:w-48 md:h-48 mx-auto text-pink-400/30" />
              </div>
            </div>
            <h1 className="text-white text-3xl md:text-5xl font-light mb-8 leading-relaxed animate-fade-in-up">
              You're not just a part of my life...
            </h1>
            <h2 className="text-transparent bg-clip-text bg-gradient-to-r from-pink-400 via-purple-400 to-blue-400 text-4xl md:text-6xl font-bold mb-12 animate-fade-in-up" style={{ animationDelay: '0.5s' }}>
              You ARE my universe.
            </h2>
            <div className="bg-white/5 backdrop-blur-lg border border-white/20 rounded-3xl p-8 md:p-12 mb-8 animate-fade-in-up" style={{ animationDelay: '1s' }}>
              <p className="text-white/90 text-lg md:text-xl leading-relaxed mb-6">
                I built this universe not because I love space... but because you made my world infinite.
              </p>
              <p className="text-white/90 text-lg md:text-xl leading-relaxed mb-6">
                Every star here is a heartbeat. Every planet is a memory.
              </p>
              <p className="text-white/90 text-lg md:text-xl leading-relaxed">
                And at the center of it all... is you.
              </p>
              <p className="text-transparent bg-clip-text bg-gradient-to-r from-yellow-400 to-pink-400 text-2xl md:text-3xl font-bold mt-8">
                My sun. My forever. ☀️
              </p>
            </div>
            <button
              onClick={replay}
              className="px-8 py-4 bg-white/10 backdrop-blur-sm border border-white/30 rounded-full text-white hover:bg-white/20 transition-all inline-flex items-center gap-2"
            >
              <RotateCcw className="w-5 h-5" />
              Orbit Forever
            </button>
          </div>
        </div>
      )}

      <style jsx>{`
        @keyframes fade-in {
          from { opacity: 0; }
          to { opacity: 1; }
        }
        @keyframes fade-in-up {
          from { opacity: 0; transform: translateY(20px); }
          to { opacity: 1; transform: translateY(0); }
        }
        @keyframes scale-in {
          from { opacity: 0; transform: scale(0.8); }
          to { opacity: 1; transform: scale(1); }
        }
        @keyframes pulse-slow {
          0%, 100% { opacity: 1; }
          50% { opacity: 0.5; }
        }
        @keyframes pulse-glow {
          0%, 100% { box-shadow: 0 0 40px currentColor, 0 0 80px currentColor; }
          50% { box-shadow: 0 0 20px currentColor, 0 0 40px currentColor; }
        }
        @keyframes float {
          0%, 100% { transform: translateY(0px); }
          50% { transform: translateY(-20px); }
        }
        @keyframes twinkle {
          0%, 100% { opacity: 0.3; }
          50% { opacity: 1; }
        }
        @keyframes star-burst {
          0% { transform: scale(1); opacity: 1; }
          100% { transform: scale(5); opacity: 0; }
        }
        @keyframes ping-slow {
          0% { transform: scale(1); opacity: 1; }
          100% { transform: scale(1.5); opacity: 0; }
        }
        .animate-fade-in { animation: fade-in 1s ease-out; }
        .animate-fade-in-up { animation: fade-in-up 1s ease-out; }
        .animate-scale-in { animation: scale-in 0.5s ease-out; }
        .animate-pulse-slow { animation: pulse-slow 3s ease-in-out infinite; }
        .animate-pulse-glow { animation: pulse-glow 2s ease-in-out infinite; }
        .animate-float { animation: float 3s ease-in-out infinite; }
        .animate-twinkle { animation: twinkle 3s ease-in-out infinite; }
        .animate-star-burst { animation: star-burst 2s ease-out; }
        .animate-ping-slow { animation: ping-slow 3s ease-out infinite; }
      `}</style>
    </div>
  );
};

export default EternalUniverse;
